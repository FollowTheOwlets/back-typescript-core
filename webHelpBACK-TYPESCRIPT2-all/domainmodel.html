<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#C14424" data-link-color="#C14424"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-01T18:55:34.9422185"><title>Доменная модель | Backend Typescript</title><script type="application/json" id="virtual-toc-data">[{"id":"-1g5i32_2","level":0,"title":"Зачем нужна доменная модель?","anchor":"#-1g5i32_2"},{"id":"-1g5i32_3","level":0,"title":"Базовые понятия доменного анализа","anchor":"#-1g5i32_3"},{"id":"-1g5i32_4","level":0,"title":"Строительные блоки модели (тактические паттерны)","anchor":"#-1g5i32_4"},{"id":"-1g5i32_5","level":0,"title":"Стратегический уровень DDD","anchor":"#-1g5i32_5"},{"id":"-1g5i32_6","level":0,"title":"Подходы к разработке вокруг модели","anchor":"#-1g5i32_6"},{"id":"-1g5i32_7","level":0,"title":"Как из предметной области получить модель (пошагово)","anchor":"#-1g5i32_7"},{"id":"-1g5i32_8","level":0,"title":"Инварианты, время и согласованность","anchor":"#-1g5i32_8"},{"id":"-1g5i32_9","level":0,"title":"Команды, запросы и CQRS как мыслительная модель","anchor":"#-1g5i32_9"},{"id":"-1g5i32_10","level":0,"title":"Анти-паттерны и частые ошибки","anchor":"#-1g5i32_10"},{"id":"-1g5i32_11","level":0,"title":"Мини-эталоны формулировок (для практики мышления)","anchor":"#-1g5i32_11"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="images/logo.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Доменная модель | Backend Typescript"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Backend Typescript Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation//1.0.0/domainmodel.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Доменная модель | Backend Typescript"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation//1.0.0/domainmodel.html#webpage",
    "url": "writerside-documentation//1.0.0/domainmodel.html",
    "name": "Доменная модель | Backend Typescript",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Backend Typescript Help"
}</script><!-- End Schema.org --></head><body data-id="DomainModel" data-main-title="Доменная модель" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="_Theory.topic|Теория///_Arch.topic|Архитектура"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Backend Typescript 1.0.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="DomainModel" id="DomainModel.topic">Доменная модель</h1><section class="chapter"><h2 id="-1g5i32_2" data-toc="-1g5i32_2">Зачем нужна доменная модель?</h2><p id="-1g5i32_12"><span id="-1g5i32_15"><b>Доменная модель</b></span> &mdash; это мыслительная конструкция, описывающая <span class="tooltip" id="-1g5i32_16" title="Часть реального мира, задачи и правила которой отражает система">предметную область</span>, её понятия, правила и ограничения в виде взаимосвязанных объектов и процессов. Её цель &mdash; чтобы программная система отражала реальные правила бизнеса, а не только структуру данных или технические детали.</p><ul class="list _bullet" id="-1g5i32_13"><li class="list__item" id="-1g5i32_17"><p>Модель делает явными термины и правила, снижая разрыв между бизнесом и разработкой.</p></li><li class="list__item" id="-1g5i32_18"><p>Модель определяет <span class="tooltip" id="-1g5i32_20" title="Правило, которое должно быть истинным для доменных данных всегда">инварианты</span> &mdash; то, что &laquo;нельзя нарушать никогда&raquo;.</p></li><li class="list__item" id="-1g5i32_19"><p>Модель задаёт границы изменений: где можно расширять поведение, а где менять нельзя.</p></li></ul><aside class="prompt" data-type="note" data-title="" id="-1g5i32_14"><p>Думайте о модели как о &laquo;языке и грамматике&raquo; системы: если термина нет в модели &mdash; система не умеет с ним работать.</p></aside></section><section class="chapter"><h2 id="-1g5i32_3" data-toc="-1g5i32_3">Базовые понятия доменного анализа</h2><section class="chapter"><h3 id="-1g5i32_21" data-toc="-1g5i32_21">Предметная область и границы смысла</h3><p id="-1g5i32_23"><span id="-1g5i32_26"><b>Предметная область</b></span> &mdash; это часть реального мира, проблемы и цели которой решает система. В ней мы выделяем <span class="tooltip" id="-1g5i32_27" title="Область, в которой термины имеют однозначный смысл">контексты</span> &mdash; области, где термины используются однозначно.</p><p id="-1g5i32_24"><span id="-1g5i32_28"><b>Единый язык (Ubiquitous Language)</b></span> &mdash; согласованные определения терминов, которыми одинаково пользуются и разработчики, и эксперты домена.</p><aside class="prompt" data-type="warning" data-title="" id="-1g5i32_25"><p>Если один и тот же термин означает разное в разных частях системы, без явных контекстов вы получите скрытые дефекты: требования &laquo;вроде понятны&raquo;, но реализованы по-разному.</p></aside></section><section class="chapter"><h3 id="-1g5i32_22" data-toc="-1g5i32_22">Модель не равна схеме БД</h3><p id="-1g5i32_29"><span id="-1g5i32_31"><b>Доменная модель</b></span> описывает правила и поведение. Схема хранения &mdash; вторична и может меняться без изменения смысла. Не подменяйте модель таблицами: колонки не выражают инварианты и политики.</p><aside class="prompt" data-type="tip" data-title="" id="-1g5i32_30"><p>Начинайте с понятий, сценариев и ограничений. Хранение и интеграции проектируйте после того, как смысл устоялся.</p></aside></section></section><section class="chapter"><h2 id="-1g5i32_4" data-toc="-1g5i32_4">Строительные блоки модели (тактические паттерны)</h2><section class="chapter"><h3 id="-1g5i32_32" data-toc="-1g5i32_32">Сущность</h3><p id="-1g5i32_37"><span id="-1g5i32_39"><b>Сущность</b></span> &mdash; объект, чья идентичность важнее текущих свойств. Идентичность постоянна на всём жизненном цикле.</p><aside class="prompt" data-type="note" data-title="" id="-1g5i32_38"><p>Сущность может менять состояние, но остаётся &laquo;той же самой&raquo; благодаря устойчивому идентификатору и истории.</p></aside></section><section class="chapter"><h3 id="-1g5i32_33" data-toc="-1g5i32_33">Значение (Value Object)</h3><p id="-1g5i32_40"><span id="-1g5i32_42"><b>Значение</b></span> &mdash; неизменяемый объект без собственной идентичности, полностью описываемый своими полями (например, денежная сумма с валютой). Два значений равны, если равны их поля.</p><aside class="prompt" data-type="warning" data-title="" id="-1g5i32_41"><p>Если вы добавляете к значению идентификатор и позволяете обновлять его &laquo;по месту&raquo;, вы разрушаете преимущество неизменяемости: проверки становятся сложнее, растёт связность.</p></aside></section><section class="chapter"><h3 id="-1g5i32_34" data-toc="-1g5i32_34">Агрегат и корень агрегата</h3><p id="-1g5i32_43"><span id="-1g5i32_46"><b>Агрегат</b></span> &mdash; когерентный кластер сущностей и значений с общими инвариантами. <span id="-1g5i32_47"><b>Корень агрегата</b></span> &mdash; единственная точка внешнего доступа и изменение состояния внутри агрегата допустимо только через него.</p><aside class="prompt" data-type="note" data-title="" id="-1g5i32_44"><p>Граница агрегата &mdash; граница транзакционной согласованности. Внутри &mdash; инварианты выдерживаются строго, между агрегатами &mdash; через политики согласования и события.</p></aside><aside class="prompt" data-type="warning" data-title="" id="-1g5i32_45"><p>Слишком крупный агрегат приводит к &laquo;всегда большим транзакциям&raquo;, блокировкам и низкой пропускной способности. Слишком мелкий &mdash; к &laquo;взрыву согласований&raquo; и хрупкости процессов.</p></aside></section><section class="chapter"><h3 id="-1g5i32_35" data-toc="-1g5i32_35">Доменные события</h3><p id="-1g5i32_48"><span id="-1g5i32_50"><b>Доменное событие</b></span> &mdash; произошедший факт в терминах домена (&laquo;Оплата проведена&raquo;, &laquo;Заказ отменён&raquo;). Событие фиксирует изменение существенного состояния и служит триггером для реакций других частей модели.</p><aside class="prompt" data-type="tip" data-title="" id="-1g5i32_49"><p>Формулируйте события в прошедшем времени: так проще понять, что именно уже истинно.</p></aside></section><section class="chapter"><h3 id="-1g5i32_36" data-toc="-1g5i32_36">Доменные службы и политики</h3><p id="-1g5i32_51"><span id="-1g5i32_52"><b>Доменная служба</b></span> &mdash; место для поведения, которое неестественно &laquo;привинчивать&raquo; к одной сущности (например, расчёт скидки по набору правил). <span id="-1g5i32_53"><b>Политика</b></span> &mdash; правило принятия решений внутри домена, независимое от инфраструктуры.</p></section></section><section class="chapter"><h2 id="-1g5i32_5" data-toc="-1g5i32_5">Стратегический уровень DDD</h2><section class="chapter"><h3 id="-1g5i32_54" data-toc="-1g5i32_54">Ограниченные контексты и карта контекстов</h3><p id="-1g5i32_56"><span id="-1g5i32_58"><b>Ограниченный контекст</b></span> &mdash; область, где <span class="tooltip" id="-1g5i32_59" title="Согласованные термины и определения, одинаково используемые разработчиками и экспертами домена">единый язык</span> применим без двусмысленностей. <span id="-1g5i32_60"><b>Карта контекстов</b></span> описывает отношения между контекстами: где один является источником истины, где требуется защита от искажения значений, где требуется переводы терминов.</p><aside class="prompt" data-type="note" data-title="" id="-1g5i32_57"><p>Границы контекстов &mdash; организационные и смысловые границы. Они помогают разделить ответственность команд и уменьшить когнитивную нагрузку.</p></aside></section><section class="chapter"><h3 id="-1g5i32_55" data-toc="-1g5i32_55">Согласованность между контекстами</h3><p id="-1g5i32_61">Строгая согласованность удобна, но дорого стоит при масштабировании. На практике часто применимо <span id="-1g5i32_63"><b>согласование со временем</b></span> (eventual consistency) через события и политики повторов.</p><aside class="prompt" data-type="warning" data-title="" id="-1g5i32_62"><p>Если бизнес-процесс требует &laquo;всё либо ничего&raquo;, держите его внутри одного агрегата или контекста. Иначе неизбежны сложные компенсации.</p></aside></section></section><section class="chapter"><h2 id="-1g5i32_6" data-toc="-1g5i32_6">Подходы к разработке вокруг модели</h2><section class="chapter"><h3 id="-1g5i32_64" data-toc="-1g5i32_64">DDD &mdash; моделирование, от языка к коду</h3><p id="-1g5i32_67"><span id="-1g5i32_70"><b>Domain-Driven Design (DDD)</b></span> &mdash; подход, при котором дизайн системы ведут доменные понятия и правила. Он включает стратегические решения (контексты, их отношения) и тактические (сущности, значения, агрегаты, события).</p><ul class="list _bullet" id="-1g5i32_68"><li class="list__item" id="-1g5i32_71"><p>Сначала язык и сценарии, потом структуры и границы.</p></li><li class="list__item" id="-1g5i32_72"><p>Инварианты &mdash; внутри агрегатов; взаимодействия &mdash; через события и политики.</p></li><li class="list__item" id="-1g5i32_73"><p>Эволюция модели &mdash; нормальный процесс: пересогласовывайте термины по мере обучения домену.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="-1g5i32_69"><p>Опасность &laquo;псевдо-DDD&raquo;: красивые слова без явных инвариантов и границ. Признак &mdash; модель не запрещает неверные состояния.</p></aside></section><section class="chapter"><h3 id="-1g5i32_65" data-toc="-1g5i32_65">TDD &mdash; проверяем поведение модели</h3><p id="-1g5i32_74"><span id="-1g5i32_78"><b>Test-Driven Development (TDD)</b></span> &mdash; цикл &laquo;красный &rarr; зелёный &rarr; рефакторинг&raquo;. Тест формулирует ожидаемое поведение в терминах домена, минимальная реализация удовлетворяет тест, затем структура упрощается без изменения поведения.</p><ul class="list _bullet" id="-1g5i32_75"><li class="list__item" id="-1g5i32_79"><p>Пишите примеры в терминах домена, а не технических деталей.</p></li><li class="list__item" id="-1g5i32_80"><p>Тестируйте инварианты агрегата: &laquo;это невозможно&raquo;, &laquo;это всегда так&raquo;.</p></li><li class="list__item" id="-1g5i32_81"><p>Фиксируйте контракты событий: что гарантируется после факта.</p></li></ul><div class="code-block" data-lang="none">


Given: Баланс счёта = 100
When: Списать 30
Then: Баланс = 70, событие &quot;СписаниеПроведено&quot;, инвариант &quot;Баланс &gt;= 0&quot; сохранён </div><aside class="prompt" data-type="warning" data-title="" id="-1g5i32_77"><p>Тесты, привязанные к внутренней реализации (частным полям, шагам), хрупки и тормозят эволюцию модели. Тестируйте поведение и контракты.</p></aside></section><section class="chapter"><h3 id="-1g5i32_66" data-toc="-1g5i32_66">EDD &mdash; событийно-ориентированное проектирование</h3><p id="-1g5i32_82"><span id="-1g5i32_86"><b>EDD (Event-Driven Design/Development)</b></span> &mdash; мышление фактами: система выражается как последовательности значимых событий и реакций на них. Сначала выявляются события и причинно-следственные связи, затем &mdash; команды, политики и агрегаты, которые делают события возможными и законными.</p><ul class="list _bullet" id="-1g5i32_83"><li class="list__item" id="-1g5i32_87"><p>События описывают &laquo;что уже произошло&raquo;, команды &mdash; &laquo;что намерены сделать&raquo;.</p></li><li class="list__item" id="-1g5i32_88"><p>События помогают разорвать жёсткие связи и согласовывать контексты.</p></li><li class="list__item" id="-1g5i32_89"><p>EDD хорошо выявляет скрытые инварианты и зависимости во времени.</p></li></ul><aside class="prompt" data-type="note" data-title="" id="-1g5i32_84"><p>Полезная практика &mdash; &laquo;разведка событиями&raquo;: набросать ленту доменных событий для ключевых сценариев, а затем группировать источники событий в агрегаты.</p></aside><aside class="prompt" data-type="warning" data-title="" id="-1g5i32_85"><p>Опасность &laquo;всё делаем событиями&raquo;: если каждое мелкое изменение &mdash; событие, модель тонет в шуме. Выделяйте только бизнес-значимые факты.</p></aside></section></section><section class="chapter"><h2 id="-1g5i32_7" data-toc="-1g5i32_7">Как из предметной области получить модель (пошагово)</h2><ul class="list _bullet" id="-1g5i32_90"><li class="list__item" id="-1g5i32_92"><p><span id="-1g5i32_99"><b>Собрать язык</b></span>: выписать термины, их определения и примеры. Уточнить неоднозначности.</p></li><li class="list__item" id="-1g5i32_93"><p><span id="-1g5i32_100"><b>Нарисовать сценарии</b></span>: кто что делает, какие результаты важны, какие ситуации запрещены.</p></li><li class="list__item" id="-1g5i32_94"><p><span id="-1g5i32_101"><b>Выявить события</b></span>: что фиксируем как &laquo;случилось&raquo;; какие инварианты должны быть верны до/после.</p></li><li class="list__item" id="-1g5i32_95"><p><span id="-1g5i32_102"><b>Сгруппировать в агрегаты</b></span>: чтобы внутри можно было строго поддерживать правила без внешних зависимостей.</p></li><li class="list__item" id="-1g5i32_96"><p><span id="-1g5i32_103"><b>Определить контексты</b></span>: где язык стабилен; как контексты взаимодействуют (источник истины, переводы понятий).</p></li><li class="list__item" id="-1g5i32_97"><p><span id="-1g5i32_104"><b>Проверить TDD-примерами</b></span>: формализовать кейсы и граничные условия; зафиксировать контракты событий.</p></li><li class="list__item" id="-1g5i32_98"><p><span id="-1g5i32_105"><b>Эволюционировать</b></span>: упрощать, переименовывать, разделять контексты по мере обучения домену.</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="-1g5i32_91"><p>Формулируйте инварианты как запреты и обязательства: &laquo;Нельзя списать больше доступного&raquo;, &laquo;Номер должен быть уникальным в границах агрегата&raquo;.</p></aside></section><section class="chapter"><h2 id="-1g5i32_8" data-toc="-1g5i32_8">Инварианты, время и согласованность</h2><p id="-1g5i32_106">Инварианты бывают локальные (внутри агрегата) и глобальные (на уровне контекста/системы). Локальные защищаются строго, глобальные согласуются через процессы и события.</p><ul class="list _bullet" id="-1g5i32_107"><li class="list__item" id="-1g5i32_109"><p><span id="-1g5i32_112"><b>Неизменяемость</b></span> значений упрощает разум о прошлом: факты не переписываются, добавляются новые события.</p></li><li class="list__item" id="-1g5i32_110"><p><span id="-1g5i32_113"><b>Идемпотентность</b></span> реакций на события снижает риск дубликатов и повторов.</p></li><li class="list__item" id="-1g5i32_111"><p><span id="-1g5i32_114"><b>Временные зависимости</b></span>: учитывайте порядок и дедлайны &mdash; это часть доменных правил.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="-1g5i32_108"><p>Смешивание строгих инвариантов с &laquo;догоняющей&raquo; согласованностью даёт иллюзию надёжности. Явно фиксируйте, что строго, а что может &laquo;дойти позже&raquo;.</p></aside></section><section class="chapter"><h2 id="-1g5i32_9" data-toc="-1g5i32_9">Команды, запросы и CQRS как мыслительная модель</h2><p id="-1g5i32_115"><span id="-1g5i32_117"><b>Команды</b></span> меняют состояние (инициируют поведение агрегатов). <span id="-1g5i32_118"><b>Запросы</b></span> читают состояние. Разделение ответственности (идея CQRS) упрощает модель: мыслите отдельно о &laquo;как меняем&raquo; и &laquo;как читаем&raquo;.</p><aside class="prompt" data-type="tip" data-title="" id="-1g5i32_116"><p>Даже если физически чтение и запись реализуются вместе, в голове держите их раздельно: это снижает связность и упрощает эволюцию.</p></aside></section><section class="chapter"><h2 id="-1g5i32_10" data-toc="-1g5i32_10">Анти-паттерны и частые ошибки</h2><ul class="list _bullet" id="-1g5i32_119"><li class="list__item" id="-1g5i32_121"><p><span id="-1g5i32_126"><b>Агрегат-&laquo;мешок данных&raquo;</b></span>: нет инвариантов, всё редактируется где угодно. Итог &mdash; состояние &laquo;вроде допустимо&raquo;, но бизнес нарушен.</p></li><li class="list__item" id="-1g5i32_122"><p><span id="-1g5i32_127"><b>Микро-агрегаты</b></span>: каждое поле &mdash; свой агрегат. Итог &mdash; бесконечные согласования и сложность процессов.</p></li><li class="list__item" id="-1g5i32_123"><p><span id="-1g5i32_128"><b>Тесты-мокеты внутренностей</b></span>: ломаются при любом рефакторинге, не ловят нарушения правил.</p></li><li class="list__item" id="-1g5i32_124"><p><span id="-1g5i32_129"><b>Событийный шум</b></span>: событие на каждый чих. Важные факты тонут в логах.</p></li><li class="list__item" id="-1g5i32_125"><p><span id="-1g5i32_130"><b>Неясные границы контекстов</b></span>: один термин означает разное &mdash; дефекты на стыках неизбежны.</p></li></ul><aside class="prompt" data-type="note" data-title="" id="-1g5i32_120"><p>Главный критерий качества модели &mdash; способность предотвращать неверные состояния естественным образом, а не &laquo;исправлять после&raquo;.</p></aside></section><section class="chapter"><h2 id="-1g5i32_11" data-toc="-1g5i32_11">Мини-эталоны формулировок (для практики мышления)</h2><div class="code-block" data-lang="none">
Правило (инвариант):
— Сумма возврата &lt;= сумме оплаченных позиций
Нарушение невозможно при корректном использовании агрегата &quot;Возврат&quot;.

Событие:
— &quot;ДоговорПодписан&quot;: после него &quot;СтатусДоговора = Активен&quot; и &quot;ДатаПодписания установленa&quot;.

Команда:
— &quot;ПодписатьДоговор&quot; требует предварительного состояния &quot;Статус = ГотовКПодписанию&quot;. </div></section><div class="last-modified">25 сентября 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="arch.html" class="navigation-links__prev">Архитектура</a><a href="monoarch.html" class="navigation-links__next">Монолитная архитектура</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>