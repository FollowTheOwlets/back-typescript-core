<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#C14424" data-link-color="#C14424"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-01T18:55:34.9482216"><title>Паттерны микросервисной архитектуры | Backend Typescript</title><script type="application/json" id="virtual-toc-data">[{"id":"rc9pkk_2","level":0,"title":"Зачем нужны паттерны","anchor":"#rc9pkk_2"},{"id":"rc9pkk_3","level":0,"title":"Базовые шаблонные сервисы и слои","anchor":"#rc9pkk_3"},{"id":"rc9pkk_4","level":0,"title":"Паттерны интеграции сервисов","anchor":"#rc9pkk_4"},{"id":"rc9pkk_5","level":0,"title":"Оркестрация и Хореография: сравнение и применение","anchor":"#rc9pkk_5"},{"id":"rc9pkk_6","level":0,"title":"Транзакции, саги и согласованность","anchor":"#rc9pkk_6"},{"id":"rc9pkk_7","level":0,"title":"Надёжность и устойчивость","anchor":"#rc9pkk_7"},{"id":"rc9pkk_8","level":0,"title":"Версионирование и эволюция контрактов","anchor":"#rc9pkk_8"},{"id":"rc9pkk_9","level":0,"title":"Наблюдаемость (Observability)","anchor":"#rc9pkk_9"},{"id":"rc9pkk_10","level":0,"title":"Выбор брокера и модель доставки","anchor":"#rc9pkk_10"},{"id":"rc9pkk_11","level":0,"title":"Примеры применения паттернов по случаям","anchor":"#rc9pkk_11"},{"id":"rc9pkk_12","level":0,"title":"Чек-лист внедрения","anchor":"#rc9pkk_12"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="images/logo.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Паттерны микросервисной архитектуры | Backend Typescript"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Backend Typescript Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation//1.0.0/micropatterns.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Паттерны микросервисной архитектуры | Backend Typescript"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation//1.0.0/micropatterns.html#webpage",
    "url": "writerside-documentation//1.0.0/micropatterns.html",
    "name": "Паттерны микросервисной архитектуры | Backend Typescript",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Backend Typescript Help"
}</script><!-- End Schema.org --></head><body data-id="MicroPatterns" data-main-title="Паттерны микросервисной архитектуры" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="_Theory.topic|Теория///_Arch.topic|Архитектура"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Backend Typescript 1.0.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="MicroPatterns" id="MicroPatterns.topic">Паттерны микросервисной архитектуры</h1><section class="chapter"><h2 id="rc9pkk_2" data-toc="rc9pkk_2">Зачем нужны паттерны</h2><p id="rc9pkk_13">Микросервисная архитектура разбивает систему на набор изолированных <span class="tooltip" id="rc9pkk_16" title="Автономный развертываемый компонент, владеющий своим состоянием и выполняющий ограниченный набор функций">сервисов</span>, каждый из которых владеет своей областью данных и логикой. Паттерны &mdash; это проверенные способы решать типичные проблемы распределённых систем: координация бизнес-процессов, обмен сообщениями, устойчивость к сбоям, согласованность данных, эволюция API и др.</p><aside class="prompt" data-type="tip" data-title="" id="rc9pkk_14"><p id="rc9pkk_17">Думайте о паттернах как о словаре решений: одно и то же требование (например, &laquo;оформить заказ&raquo;) можно реализовать через <span class="tooltip" id="rc9pkk_18" title="Централизованное управление долгоживущим процессом специальным координатором с хранением состояний и компенсаций">оркестрацию</span> или <span class="tooltip" id="rc9pkk_19" title="Распределённая координация, когда участники реагируют на события без центрального управляющего узла">хореографию</span> &mdash; выбор зависит от связности, наблюдаемости, зрелости команды и динамики домена.</p></aside><aside class="prompt" data-type="warning" data-title="" id="rc9pkk_15"><p id="rc9pkk_20">Паттерн &mdash; не самоцель. Он добавляет сложность. Применяйте только там, где выгода (масштабируемость, независимые релизы, устойчивость) перекрывает издержки (координация, отладка, кросс-сервисная транзакционность).</p></aside></section><section class="chapter"><h2 id="rc9pkk_3" data-toc="rc9pkk_3">Базовые шаблонные сервисы и слои</h2><section class="chapter"><h3 id="rc9pkk_21" data-toc="rc9pkk_21">Edge-слой: API Gateway и BFF</h3><p id="rc9pkk_24"><span id="rc9pkk_27"><b>API Gateway</b></span> &mdash; фасад, единая точка входа для внешних клиентов. Выполняет агрегацию, маршрутизацию, политику безопасности, ограничение трафика, кэширование. <span id="rc9pkk_28"><b>BFF</b></span> (Backend For Frontend) &mdash; специализированный фасад под конкретный клиент (веб, мобильный), скрывающий сложность внутренних API.</p><aside class="prompt" data-type="note" data-title="" id="rc9pkk_25"><p id="rc9pkk_29">Разносите общие кросс-срезовые задачи (аутентификация, лимиты, логирование) в Gateway, а форматирование ответов под конкретный UI &mdash; в BFF. Так вы уменьшите дублирование логики в фронтендах.</p></aside><aside class="prompt" data-type="warning" data-title="" id="rc9pkk_26"><p id="rc9pkk_30">Не превращайте Gateway в &laquo;толстый&raquo; монолит: бизнес-правила и длинные блокирующие сценарии должны жить в доменных сервисах.</p></aside></section><section class="chapter"><h3 id="rc9pkk_22" data-toc="rc9pkk_22">Доменные сервисы (Core Services)</h3><p id="rc9pkk_31">Каждый доменный сервис владеет своей <span class="tooltip" id="rc9pkk_33" title="Структура сущностей и связей, которой владеет сервис и за целостность которой он отвечает">моделью данных</span> и реализует чёткий <span class="tooltip" id="rc9pkk_34" title="Чёткая граница предметной области, внутри которой термины и модели имеют однозначные значения">bounded context</span>. Общение между сервисами &mdash; асинхронными событиями или синхронными запросами, в зависимости от критичности и зависимостей.</p><aside class="prompt" data-type="tip" data-title="" id="rc9pkk_32"><p id="rc9pkk_35">Стройте сервисы вокруг устойчивых доменных инвариантов (например, <code class="code" id="rc9pkk_36">Payment</code>, <code class="code" id="rc9pkk_37">Order</code>, <code class="code" id="rc9pkk_38">Inventory</code>), а не вокруг технических слоёв (например, &laquo;сервис БД&raquo;).</p></aside></section><section class="chapter"><h3 id="rc9pkk_23" data-toc="rc9pkk_23">Сервисы-поддержки (Supporting Services)</h3><ul class="list _bullet" id="rc9pkk_39"><li class="list__item" id="rc9pkk_41"><p><span id="rc9pkk_45"><b>Auth/Identity</b></span> &mdash; аутентификация, авторизация, управление токенами.</p></li><li class="list__item" id="rc9pkk_42"><p><span id="rc9pkk_46"><b>Notification</b></span> &mdash; e-mail/SMS/Push, шаблоны, ретраи, дед-леттер.</p></li><li class="list__item" id="rc9pkk_43"><p><span id="rc9pkk_47"><b>Reporting/Analytics</b></span> &mdash; витрины, материализованные представления.</p></li><li class="list__item" id="rc9pkk_44"><p><span id="rc9pkk_48"><b>File/Media</b></span> &mdash; загрузка, хранение, CDN-ссылки, вирус-скан.</p></li></ul><aside class="prompt" data-type="note" data-title="" id="rc9pkk_40"><p id="rc9pkk_49">Вынесение кросс-доменных задач в отдельные сервисы снижает дублирование и упрощает масштабирование по профилю нагрузки.</p></aside></section></section><section class="chapter"><h2 id="rc9pkk_4" data-toc="rc9pkk_4">Паттерны интеграции сервисов</h2><section class="chapter"><h3 id="rc9pkk_50" data-toc="rc9pkk_50">Синхронные запросы/ответы (HTTP/gRPC)</h3><p id="rc9pkk_53">Используются для запросов, требующих мгновенной обратной связи (например, проверка баланса перед оплатой). Подход прост в реализации, но увеличивает связность и риск каскадных таймаутов.</p><aside class="prompt" data-type="warning" data-title="" id="rc9pkk_54"><p id="rc9pkk_56">В цепочке из N синхронных вызовов вероятность таймаута растёт. Всегда применяйте <span class="tooltip" id="rc9pkk_57" title="Механизм, предотвращающий каскадные ошибки, размыкая вызовы к нестабильной зависимости">Circuit Breaker</span>, таймауты, лимиты повторов и <span class="tooltip" id="rc9pkk_58" title="Изоляция ресурсов между частями системы, чтобы сбой в одном сегменте не уронил остальные">Bulkhead</span>.</p></aside><div class="code-block" data-lang="ts">
// Gateway -&gt; Orders -&gt; Payments (глубина 2, таймауты короче суммарного SLA)
const paymentOk = await withTimeout(() =&gt; payments.authorize(orderId), 800);
      </div></section><section class="chapter"><h3 id="rc9pkk_51" data-toc="rc9pkk_51">Асинхронные события (Event-Driven)</h3><p id="rc9pkk_59">Сервисы публикуют факты (<span id="rc9pkk_61"><b>события-доменные факты</b></span>) в шину; подписчики реагируют независимо, что снижает связность и повышает масштабируемость.</p><aside class="prompt" data-type="tip" data-title="" id="rc9pkk_60"><p id="rc9pkk_62">Событие &mdash; прошедший факт, а не команда. Именуйте прошедшим временем: <code class="code" id="rc9pkk_63">OrderCreated</code>, <code class="code" id="rc9pkk_64">PaymentAuthorized</code>.</p></aside></section><section class="chapter"><h3 id="rc9pkk_52" data-toc="rc9pkk_52">Команды (Command) и запросы (Query)</h3><p id="rc9pkk_65"><span id="rc9pkk_67"><b>Команда</b></span> инициирует действие и может быть асинхронной. <span id="rc9pkk_68"><b>Запрос</b></span> читает состояние и обычно синхронен. Разделение упрощает масштабирование и кэширование.</p><aside class="prompt" data-type="note" data-title="" id="rc9pkk_66"><p id="rc9pkk_69">Вместе формируют основу <span class="tooltip" id="rc9pkk_70" title="Идея разделения моделей и потоков чтения и записи для упрощения проектирования">CQRS</span>: отдельные модели для чтения и записи.</p></aside></section></section><section class="chapter"><h2 id="rc9pkk_5" data-toc="rc9pkk_5">Оркестрация и Хореография: сравнение и применение</h2><section class="chapter"><h3 id="rc9pkk_71" data-toc="rc9pkk_71">Что такое Оркестрация</h3><p id="rc9pkk_74"><span class="tooltip" id="rc9pkk_77" title="Централизованное управление долгоживущим процессом специальным координатором с хранением состояний и компенсаций">Оркестрация</span> &mdash; централизованное управление долгоживущим бизнес-процессом специальным координатором (оркестратором/процесс-менеджером). Он вызывает шаги по сценарию, хранит состояние, выполняет компенсации.</p><ul class="list _bullet" id="rc9pkk_75"><li class="list__item" id="rc9pkk_78"><p><span id="rc9pkk_80"><b>Плюсы</b></span>: прозрачный контроль потока, явные состояния, простая отладка, единые SLA.</p></li><li class="list__item" id="rc9pkk_79"><p><span id="rc9pkk_81"><b>Минусы</b></span>: центральная точка координации, потенциальная &laquo;бутылочная горлышко&raquo;, сильнее связь с участниками.</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="rc9pkk_76"><p id="rc9pkk_82">Оркестратор &mdash; отдельный компонент/сервис. Он не обязан быть &laquo;бог-объектом&raquo; &mdash; держите только состояние процесса и ссылки на шаги.</p></aside></section><section class="chapter"><h3 id="rc9pkk_72" data-toc="rc9pkk_72">Что такое Хореография</h3><p id="rc9pkk_83"><span class="tooltip" id="rc9pkk_86" title="Распределённая координация, когда участники реагируют на события без центрального управляющего узла">Хореография</span> &mdash; распределённая координация: каждый участник подписывается на релевантные события и самостоятельно решает, что делать дальше. Нет единого центра принятия решений.</p><ul class="list _bullet" id="rc9pkk_84"><li class="list__item" id="rc9pkk_87"><p><span id="rc9pkk_89"><b>Плюсы</b></span>: низкая связность, простая эволюция, горизонтальная масштабируемость.</p></li><li class="list__item" id="rc9pkk_88"><p><span id="rc9pkk_90"><b>Минусы</b></span>: сложнее прослеживать цепочку, риск непреднамеренных циклов, труднее ввести глобальные правила.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="rc9pkk_85"><p id="rc9pkk_91">При добавлении нового подписчика меняется поведение системы. Вводите контрактные тесты и наблюдаемость с кореляцией трассировок.</p></aside></section><section class="chapter"><h3 id="rc9pkk_73" data-toc="rc9pkk_73">Где какой подход уместен</h3><ul class="list _bullet" id="rc9pkk_92"><li class="list__item" id="rc9pkk_94"><p><span id="rc9pkk_96"><b>Оркестрация</b></span>: сложные, регламентированные процессы с явными этапами и компенсациями (оформление кредита, KYC, биллинг). Требуется единая точка контроля статусов.</p></li><li class="list__item" id="rc9pkk_95"><p><span id="rc9pkk_97"><b>Хореография</b></span>: событийное расширение вокруг &laquo;ядра&raquo; (уведомления, аналитика, кэш-проекции, интеграции с партнёрами), где важно низкое сцепление и независимые релизы.</p></li></ul><aside class="prompt" data-type="note" data-title="" id="rc9pkk_93"><p id="rc9pkk_98">Комбинируйте: критический &laquo;скелет&raquo; процесса &mdash; оркестрация; периферийные реакции &mdash; хореография.</p></aside></section></section><section class="chapter"><h2 id="rc9pkk_6" data-toc="rc9pkk_6">Транзакции, саги и согласованность</h2><section class="chapter"><h3 id="rc9pkk_99" data-toc="rc9pkk_99">Сага как общий паттерн</h3><p id="rc9pkk_102"><span class="tooltip" id="rc9pkk_105" title="Паттерн распределённых транзакций: последовательность локальных действий с компенсирующими операциями при неуспехе">Сага</span> &mdash; разбиение распределённой транзакции на последовательность локальных шагов с <span id="rc9pkk_106"><b>компенсирующими действиями</b></span>. Бывает оркестрируемая и хореографическая.</p><div class="code-block" data-lang="ts">
// Оркестрируемая сага (псевдокод)
await step(&quot;ReserveInventory&quot;, () =&gt; inventory.reserve(orderId), () =&gt; inventory.release(orderId));
await step(&quot;AuthorizePayment&quot;, () =&gt; payments.authorize(orderId), () =&gt; payments.refund(orderId));
await step(&quot;ConfirmOrder&quot;, () =&gt; orders.confirm(orderId), () =&gt; orders.markFailed(orderId));
      </div><aside class="prompt" data-type="warning" data-title="" id="rc9pkk_104"><p id="rc9pkk_107">Компенсация &mdash; не всегда &laquo;идеальный откат&raquo;. Продумывайте неизбежные остаточные эффекты (уведомления, сторонние системы).</p></aside></section><section class="chapter"><h3 id="rc9pkk_100" data-toc="rc9pkk_100">Outbox и транзакционная доставка</h3><p id="rc9pkk_108"><span class="tooltip" id="rc9pkk_111" title="Транзакционная запись события в локовое хранилище с последующей надёжной публикацией в брокер">Outbox</span> &mdash; запись события в таблицу <code class="code" id="rc9pkk_112">outbox</code> в одной транзакции с изменением агрегата, а затем асинхронная публикация из outbox в брокер. Гарантирует &laquo;сначала запись, потом публикация&raquo; без потерь.</p><div class="code-block" data-lang="sql">


\-- Изменение статуса заказа и запись события в одной транзакции
BEGIN;
UPDATE orders
SET status = 'CONFIRMED'
WHERE id = 'o-42';
INSERT INTO outbox(id, topic, payload, created\_at)
VALUES ('e-123', 'order.confirmed', '{...}', now());
COMMIT; </div><aside class="prompt" data-type="tip" data-title="" id="rc9pkk_110"><p id="rc9pkk_113">Добавьте <code class="code" id="rc9pkk_114">processed\_at</code>, <code class="code" id="rc9pkk_115">retry\_count</code>, идемпотентные ключи и дед-леттер очередь для &laquo;ядовитых&raquo; сообщений.</p></aside></section><section class="chapter"><h3 id="rc9pkk_101" data-toc="rc9pkk_101">CQRS и Event Sourcing</h3><p id="rc9pkk_116"><span class="tooltip" id="rc9pkk_118" title="Идея разделения моделей и потоков чтения и записи для упрощения проектирования">CQRS</span> разделяет модели записи и чтения для масштабирования и целостности. <span class="tooltip" id="rc9pkk_119" title="Подход, при котором система хранит не текущее состояние, а журнал доменных событий">Event Sourcing</span> хранит последовательность событий как источник истины; состояние восстанавливается через &laquo;реплей&raquo;.</p><aside class="prompt" data-type="warning" data-title="" id="rc9pkk_117"><p id="rc9pkk_120">Event Sourcing повышает сложность (миграции, реплей, эволюция схемы событий). Используйте при высокой ценности аудита и воспроизводимости.</p></aside></section></section><section class="chapter"><h2 id="rc9pkk_7" data-toc="rc9pkk_7">Надёжность и устойчивость</h2><ul class="list _bullet" id="rc9pkk_121"><li class="list__item" id="rc9pkk_124"><p><span class="tooltip" id="rc9pkk_130" title="Механизм, предотвращающий каскадные ошибки, размыкая вызовы к нестабильной зависимости">Circuit Breaker</span>: &laquo;размыкает цепь&raquo; при ошибках/таймаутах, затем полуоткрытый режим для проб.</p></li><li class="list__item" id="rc9pkk_125"><p><span class="tooltip" id="rc9pkk_131" title="Изоляция ресурсов между частями системы, чтобы сбой в одном сегменте не уронил остальные">Bulkhead</span>: изоляция пулов (соединения, очереди) между фичами, чтобы сбой не уронил всё.</p></li><li class="list__item" id="rc9pkk_126"><p>Повторы с экспоненциальной паузой и джиттером; уважайте идемпотентность.</p></li><li class="list__item" id="rc9pkk_127"><p><span class="tooltip" id="rc9pkk_132" title="Свойство операции давать тот же итог при повторном выполнении с теми же данными">Идемпотентность</span>: повтор одного и того же запроса не меняет итоговое состояние.</p></li><li class="list__item" id="rc9pkk_128"><p>Таймауты и дедлайны для шагов саги; компенсации и алерты.</p></li><li class="list__item" id="rc9pkk_129"><p><span class="tooltip" id="rc9pkk_133" title="Очередь для сообщений, неоднократно не обработанных успешно потребителем">Dead-Letter Queue</span> для сообщений, не прошедших после N попыток.</p></li></ul><div class="code-block" data-lang="ts">
// Идемпотентный обработчик сообщения
const key = msg.headers[&quot;Idempotency-Key&quot;];
if (await store.seen(key)) return; // уже обработано
await handle(msg.payload);
await store.mark(key);
    </div><aside class="prompt" data-type="warning" data-title="" id="rc9pkk_123"><p id="rc9pkk_134">Повторы без идемпотентности приводят к двойному списанию, дублированию заказов и &laquo;фантомным&raquo; состояниям.</p></aside></section><section class="chapter"><h2 id="rc9pkk_8" data-toc="rc9pkk_8">Версионирование и эволюция контрактов</h2><p id="rc9pkk_135">Контракты должны эволюционировать без &laquo;ломающих&raquo; изменений: добавляйте поля необязательными, не переименовывайте значения событий, используйте <span id="rc9pkk_137"><b>согласованную схему</b></span> (Avro/JSON Schema/Protobuf) и контрактные тесты потребителей.</p><aside class="prompt" data-type="tip" data-title="" id="rc9pkk_136"><p id="rc9pkk_138">Для HTTP &mdash; поддерживайте параллельно <code class="code" id="rc9pkk_139">/v1</code> и <code class="code" id="rc9pkk_140">/v2</code>. Для событий &mdash; вводите новые типы (<code class="code" id="rc9pkk_141">OrderConfirmed.v2</code>), сохраняя старые до миграции подписчиков.</p></aside></section><section class="chapter"><h2 id="rc9pkk_9" data-toc="rc9pkk_9">Наблюдаемость (Observability)</h2><p id="rc9pkk_142">Три столпа: логирование, метрики, трассировка. Для распределённых процессов обязательно <span id="rc9pkk_144"><b>корреляция</b></span> через <code class="code" id="rc9pkk_145">traceId</code>/<code class="code" id="rc9pkk_146">spanId</code>, проброс контекста через шину, спаны на шаги саги и компенсации.</p><aside class="prompt" data-type="warning" data-title="" id="rc9pkk_143"><p id="rc9pkk_147">Без трассировки хореография превращается в &laquo;чёрный ящик&raquo;: сложно понять, где &laquo;застряла&raquo; цепочка.</p></aside></section><section class="chapter"><h2 id="rc9pkk_10" data-toc="rc9pkk_10">Выбор брокера и модель доставки</h2><p id="rc9pkk_148">Оценивайте семантику доставки (<span id="rc9pkk_150"><b>at-least-once</b></span>, <span id="rc9pkk_151"><b>at-most-once</b></span>, <span id="rc9pkk_152"><b>exactly-once</b></span> как архитектурная цель), требования к порядку, объёмы сообщений, задержки и количество подписчиков.</p><aside class="prompt" data-type="note" data-title="" id="rc9pkk_149"><p id="rc9pkk_153">В большинстве бизнес-кейсов достаточно <span id="rc9pkk_154"><b>at-least-once</b></span> + идемпотентность потребителей и <span class="tooltip" id="rc9pkk_155" title="Транзакционная запись события в локовое хранилище с последующей надёжной публикацией в брокер">outbox</span> у продюсеров.</p></aside></section><section class="chapter"><h2 id="rc9pkk_11" data-toc="rc9pkk_11">Примеры применения паттернов по случаям</h2><section class="chapter"><h3 id="rc9pkk_156" data-toc="rc9pkk_156">Оформление заказа (ядро + периферия)</h3><ul class="list _bullet" id="rc9pkk_159"><li class="list__item" id="rc9pkk_160"><p><span id="rc9pkk_162"><b>Оркестрация</b></span> для ядра: резерв склада &rarr; авторизация платежа &rarr; подтверждение заказа &rarr; счёт. Явные компенсации при отказе.</p></li><li class="list__item" id="rc9pkk_161"><p><span id="rc9pkk_163"><b>Хореография</b></span> для периферии: уведомления, обновление рекомендаций, аналитические проекции, вебхуки партнёрам.</p></li></ul></section><section class="chapter"><h3 id="rc9pkk_157" data-toc="rc9pkk_157">Пополнение баланса (внешние интеграции)</h3><p id="rc9pkk_164">Асинхронные вебхуки от провайдера &rarr; хореография реакций (обновить баланс, отправить чек). Оркестратор не нужен, если нет сложных зависимостей.</p></section><section class="chapter"><h3 id="rc9pkk_158" data-toc="rc9pkk_158">Возврат средств (компенсационные сценарии)</h3><p id="rc9pkk_165">Оркестрация с явным хранением статусов: <code class="code" id="rc9pkk_166">REQUESTED</code> &rarr; <code class="code" id="rc9pkk_167">APPROVED</code> &rarr; <code class="code" id="rc9pkk_168">REFUNDED</code>. Компенсации и SLA на каждом шаге, DLQ для ошибок провайдера.</p></section></section><section class="chapter"><h2 id="rc9pkk_12" data-toc="rc9pkk_12">Чек-лист внедрения</h2><ul class="list _bullet" id="rc9pkk_169"><li class="list__item" id="rc9pkk_170"><p>Определите границы контекстов и агрегатов. Сервис владеет своей схемой БД.</p></li><li class="list__item" id="rc9pkk_171"><p>Выберите модель координации: оркестрация (ядро) vs хореография (расширения).</p></li><li class="list__item" id="rc9pkk_172"><p>Гарантируйте доставку: outbox, идемпотентность, ретраи, DLQ.</p></li><li class="list__item" id="rc9pkk_173"><p>Добавьте устойчивость: circuit breaker, timeouts, bulkhead, backoff с джиттером.</p></li><li class="list__item" id="rc9pkk_174"><p>Обеспечьте наблюдаемость: трассировка сквозь все шаги, корреляция по traceId.</p></li><li class="list__item" id="rc9pkk_175"><p>Планируйте эволюцию контрактов: совместимость, версии, контрактные тесты.</p></li></ul></section><div class="last-modified">01 октября 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="microarch.html" class="navigation-links__prev">Микросервисная архитектура</a><a href="backend.html" class="navigation-links__next">Backend</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>