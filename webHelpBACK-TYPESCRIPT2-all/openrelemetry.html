<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#C14424" data-link-color="#C14424"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-01T18:55:35.1023603"><title>Трассировки и мониторинг. Траблшутинг | Backend Typescript</title><script type="application/json" id="virtual-toc-data">[{"id":"-um5csm_3","level":0,"title":"Картина в целом: три столпа наблюдаемости и как их связать","anchor":"#-um5csm_3"},{"id":"-um5csm_4","level":0,"title":"OpenTelemetry: единый язык данных наблюдаемости","anchor":"#-um5csm_4"},{"id":"-um5csm_5","level":0,"title":"Jaeger: просмотр и анализ распределённых трасс","anchor":"#-um5csm_5"},{"id":"-um5csm_6","level":0,"title":"Prometheus: метрики и алертинг","anchor":"#-um5csm_6"},{"id":"-um5csm_7","level":0,"title":"Grafana: дашборды, корреляция и алерты","anchor":"#-um5csm_7"},{"id":"-um5csm_8","level":0,"title":"Корреляция логов, метрик и трейсов на практике","anchor":"#-um5csm_8"},{"id":"-um5csm_9","level":0,"title":"Методики траблшутинга: RED, USE, чек-листы","anchor":"#-um5csm_9"},{"id":"-um5csm_10","level":0,"title":"Производительность и стоимость: семплинг, бакеты, ретеншн","anchor":"#-um5csm_10"},{"id":"-um5csm_11","level":0,"title":"Безопасность и соответствие требованиям","anchor":"#-um5csm_11"},{"id":"-um5csm_12","level":0,"title":"Типовые ошибки и их исправление","anchor":"#-um5csm_12"},{"id":"-um5csm_13","level":0,"title":"FAQ и лучшие практики","anchor":"#-um5csm_13"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="images/logo.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Трассировки и мониторинг. Траблшутинг | Backend Typescript"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Backend Typescript Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation//1.0.0/openrelemetry.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Трассировки и мониторинг. Траблшутинг | Backend Typescript"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation//1.0.0/openrelemetry.html#webpage",
    "url": "writerside-documentation//1.0.0/openrelemetry.html",
    "name": "Трассировки и мониторинг. Траблшутинг | Backend Typescript",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Backend Typescript Help"
}</script><!-- End Schema.org --></head><body data-id="OpenRelemetry" data-main-title="Трассировки и мониторинг. Траблшутинг" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="_Backend.topic|Backend"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Backend Typescript 1.0.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="OpenRelemetry" id="OpenRelemetry.topic">Трассировки и мониторинг. Траблшутинг</h1><p id="-um5csm_2">В production-системах неизбежно возникают инциденты: ошибки, деградация производительности, нестабильность сетей и внешних зависимостей. Чтобы быстро находить первопричину и подтверждать гипотезы данными, применяют стек наблюдаемости: <span class="tooltip" id="-um5csm_14" title="Полный путь запроса через распределённую систему, состоящий из множества спанов">трассировки</span>, <span class="tooltip" id="-um5csm_15" title="Агрегированные числовые показатели работы системы (латентность, ошибки, нагрузка), используемые для алертинга">метрики</span>, <span class="tooltip" id="-um5csm_16" title="Структурированная или текстовая запись событий, происходящих в системе (запросы, ошибки, служебные сообщения). Логи помогают восстановить последовательность действий и контекст инцидента: кто вызвал операцию, какие параметры были переданы, что вернулось. Лучшие практики: писать в формате JSON, добавлять trace_id/span_id для корреляции с трассами, избегать ПДн и секретов, использовать уровни (debug, info, warn, error) и ротацию/ретеншн.">логи</span> (часто дополняют <span class="tooltip" id="-um5csm_17" title="Методика детального измерения использования ресурсов и времени выполнения внутри процесса (CPU, память, аллокации, блокировки, системные вызовы). Позволяет находить горячие точки (hot paths), утечки памяти, лишние аллокации и контентьон. Обычно выполняется локально или на staging с профайлерами (CPU/Heap/Wall/Block), результат анализируют через flame graph/trace view. Отличается от трейсов тем, что измеряет не путь запроса между сервисами, а внутреннюю работу конкретного процесса.">профилированием</span>). В этом топике мы последовательно разберём архитектуру наблюдаемости и роль <span class="tooltip" id="-um5csm_18" title="Набор стандартов, SDK и Collector для сбора и экспорта наблюдаемости">OpenTelemetry</span>, <span class="tooltip" id="-um5csm_19" title="Система хранения и визуализации распределённых трасс">Jaeger</span>, <span class="tooltip" id="-um5csm_20" title="Система мониторинга и база временных рядов (TSDB) с pull-моделью: сама опрашивает цели по эндпойнту /metrics. Поддерживает типы метрик Counter, Gauge, Histogram, Summary и язык запросов PromQL для агрегаций, квантилей и алертинга. В экосистему входит Alertmanager для маршрутизации оповещений. Требует аккуратной работы с метками, чтобы сдерживать кардинальность и стоимость.">Prometheus</span> и <span class="tooltip" id="-um5csm_21" title="Платформа визуализации, дашбордов и алертов, поддерживающая множество источников данных">Grafana</span> в траблшутинге.</p><section class="chapter"><h2 id="-um5csm_3" data-toc="-um5csm_3">Картина в целом: три столпа наблюдаемости и как их связать</h2><p id="-um5csm_22">Наблюдаемость состоит из трёх основных потоков данных: <span id="-um5csm_25"><b>трассировки</b></span> (кто, когда и что вызвал), <span id="-um5csm_26"><b>метрики</b></span> (числа и временные ряды для трендов и порогов), <span id="-um5csm_27"><b>логи</b></span> (подробные события и текст для контекста). Эффективный траблшутинг требует корреляции: из алерта по метрике перейти к связанным трейсам и логам той же операции с тем же <code class="code" id="-um5csm_28">trace_id</code>.</p><ul class="list _bullet" id="-um5csm_23"><li class="list__item" id="-um5csm_29"><p><span id="-um5csm_34"><b>SLO/SLI/SLA</b></span>: определите целевые уровни качества (например, <span class="tooltip" id="-um5csm_35" title="Перцентиль 95 (P95) - Значение метрики, ниже которого находится 95% наблюдений за период. Для latency это «время, которое не превышает 95% запросов», а 5% самых медленных — выше P95. Перцентили устойчивее среднего и показывают опыт большинства пользователей. Используются для SLO (например, «P95 latency ≤ 300 мс»). Вычисляются по гистограммам/квантильным алгоритмам; важно выбирать адекватные бакеты и окно агрегации.">P95</span> latency &le; 300&nbsp;мс, ошибки &le; 1%).</p></li><li class="list__item" id="-um5csm_30"><p><span id="-um5csm_36"><b>Golden signals</b></span>: <span class="tooltip" id="-um5csm_37" title="Время отклика системы — интервал между началом операции (например, получением запроса) и её завершением (отправкой ответа). Измеряется в миллисекундах/секундах. Бывает «end-to-end» (полный путь клиента) и «server-side» (только сервер). Для оценки качества используют перцентили (P50, P95, P99), потому что среднее скрывает хвосты медленных запросов. Важно фиксировать метод измерения, источник времени и границы (включает ли сети, прокси, ретраи).">latency</span>, traffic, errors, <span class="tooltip" id="-um5csm_38" title="Насыщение — степень загруженности ресурса (CPU, память, пул подключений, очередь запросов), при которой система приближается к пределу пропускной способности. Растущая насыщённость часто ведёт к увеличению latency и ошибкам. Отслеживается через метрики использования и очередей (например, длина очереди, занятость пула, load average) и пороги алертинга, привязанные к SLO.">saturation</span> (перегрузка).</p></li><li class="list__item" id="-um5csm_31"><p><span id="-um5csm_39"><b>Инструментирование</b></span>: добавьте SDK/агенты, чтобы сервисы отдавали трейсинг и метрики.</p></li><li class="list__item" id="-um5csm_32"><p><span id="-um5csm_40"><b>Хранилища</b></span>: временные ряды (Prometheus), распределённые трейс-хранилища (Jaeger/Tempo и др.), системы логов.</p></li><li class="list__item" id="-um5csm_33"><p><span id="-um5csm_41"><b>Дашборды и алерты</b></span>: визуализация (Grafana), правила алертинга (Prometheus Alertmanager или Grafana Alerting).</p></li></ul><aside class="prompt" data-type="note" data-title="" id="-um5csm_24"><p>Корреляция достигается благодаря распространению контекста: передавайте <code class="code" id="-um5csm_42">traceparent</code> (W3C Trace Context) между сервисами и в логи.</p></aside></section><section class="chapter"><h2 id="-um5csm_4" data-toc="-um5csm_4">OpenTelemetry: единый язык данных наблюдаемости</h2><p id="-um5csm_43"><span class="tooltip" id="-um5csm_46" title="Набор стандартов, SDK и Collector для сбора и экспорта наблюдаемости">OpenTelemetry (OTel)</span> &mdash; открытый стандарт и набор SDK/агентов для сбора <span id="-um5csm_47"><b>трейсов</b></span>, <span id="-um5csm_48"><b>метрик</b></span> и <span id="-um5csm_49"><b>логов</b></span> с едиными <span class="tooltip" id="-um5csm_50" title="Стандартизированные имена и наборы атрибутов для сигналов наблюдаемости (трейсов, метрик, логов), чтобы разные сервисы описывали события одинаково. В OpenTelemetry это, например, единые ключи для HTTP-запросов (http.method, http.route, http.status_code), баз данных (db.system, db.statement) и облачной инфраструктуры. Соблюдение соглашений упрощает поиск, корреляцию и построение универсальных дашбордов и алертов.">семантическими соглашениями</span>. OTel отделяет сбор (SDK, автоподключаемые инструменты, <span class="tooltip" id="-um5csm_51" title="Сервис OpenTelemetry для приёма, обработки (фильтрация, семплинг) и экспорта сигналов">Collector</span>) от доставки (экспортеры) и хранилищ (Jaeger/Tempo, Prometheus/OTLP-метрики, лог-системы).</p><section class="chapter"><h3 id="-um5csm_44" data-toc="-um5csm_44">Ключевые понятия OTel</h3><ul class="list _bullet" id="-um5csm_52"><li class="list__item" id="-um5csm_55"><p><span id="-um5csm_60"><b>Span</b></span>: атомарная операция (RPC, запрос к БД, вызов очереди) со временем начала/окончания, атрибутами, статусом.</p></li><li class="list__item" id="-um5csm_56"><p><span id="-um5csm_61"><b>Trace</b></span>: дерево/граф <code class="code" id="-um5csm_62">span</code>-ов, отражающее путь запроса через сервисы.</p></li><li class="list__item" id="-um5csm_57"><p><span id="-um5csm_63"><b>Context propagation</b></span>: перенос <code class="code" id="-um5csm_64">trace_id/span_id</code> через заголовки (W3C <code class="code" id="-um5csm_65">traceparent</code>, <code class="code" id="-um5csm_66">baggage</code>).</p></li><li class="list__item" id="-um5csm_58"><p><span id="-um5csm_67"><b>Sampler</b></span>: политика отбора (always_on/off, parentbased, вероятностная, tail-based через Collector).</p></li><li class="list__item" id="-um5csm_59"><p><span id="-um5csm_68"><b>OTLP</b></span>: бинарный протокол/формат доставки (gRPC/HTTP) для трёх типов сигналов (traces/metrics/logs).</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="-um5csm_53"><p>Начните с вероятностного семплинга 5&ndash;10% на высоконагруженных сервисах и включайте целевой семплинг для ошибок.</p></aside><aside class="prompt" data-type="warning" data-title="" id="-um5csm_54"><p>Не добавляйте PII/секреты в атрибуты спанов и логи. Настройте редактирование/маскирование на стороне Collector.</p></aside></section><section class="chapter"><h3 id="-um5csm_45" data-toc="-um5csm_45">OpenTelemetry Collector: централизованный приём, обработка, экспорт</h3><p id="-um5csm_69">Collector &mdash; отдельный сервис, принимающий данные по OTLP, делающий парсинг/фильтрацию/семплинг и отправку в хранилища. Его удобно деплоить как sidecar/agent на узел или как централизованный gateway.</p><div class="code-block" data-lang="yaml">
                receivers:
                    otlp:
                        protocols:
                            grpc:
                            http:

                    processors:
                        batch:
                        attributes:
                            actions:
                                - key: http.request.header.authorization
                                  action: delete

                    exporters:
                        otlphttp:
                            endpoint: http://jaeger-collector:4318
                        prometheus:
                            endpoint: 0.0.0.0:9464

                    service:
                        pipelines:
                            traces:
                                receivers: [otlp]
                                processors: [batch, attributes]
                                exporters: [otlphttp]
                            metrics:
                                receivers: [otlp]
                                processors: [batch]
                                exporters: [prometheus]
            </div><aside class="prompt" data-type="tip" data-title="" id="-um5csm_71"><p>Секция <code class="code" id="-um5csm_72">attributes</code> позволяет маскировать чувствительные поля до сохранения в хранилище.</p></aside></section></section><section class="chapter"><h2 id="-um5csm_5" data-toc="-um5csm_5">Jaeger: просмотр и анализ распределённых трасс</h2><p id="-um5csm_73"><span class="tooltip" id="-um5csm_77" title="Система хранения и визуализации распределённых трасс">Jaeger</span> &mdash; система хранения и визуализации трейсингов. Позволяет видеть путь запроса через микросервисы, длительность каждого этапа, ошибки и узкие места. Компоненты: <code class="code" id="-um5csm_78">agent</code> (приём), <code class="code" id="-um5csm_79">collector</code> (агрегация), <code class="code" id="-um5csm_80">query</code> и <code class="code" id="-um5csm_81">UI</code>. Хранение: Elasticsearch, Cassandra или встроенные варианты для dev.</p><ul class="list _bullet" id="-um5csm_74"><li class="list__item" id="-um5csm_82"><p><span id="-um5csm_85"><b>Поиск</b></span> по сервису, операции, тегам (атрибутам), временному окну.</p></li><li class="list__item" id="-um5csm_83"><p><span id="-um5csm_86"><b>Service map</b></span> и сравнение трейсов (baseline vs regression).</p></li><li class="list__item" id="-um5csm_84"><p><span id="-um5csm_87"><b>Root cause</b></span>: быстро выявляйте самый долгий/ошибочный span.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="-um5csm_75"><p>Высокая подробность + долгий ретеншн =&gt; рост стоимости хранения. Включайте семплинг и ретеншн-политики.</p></aside><aside class="prompt" data-type="tip" data-title="" id="-um5csm_76"><p>Передавайте <code class="code" id="-um5csm_88">trace_id</code> в ответы API и логи &mdash; это ускоряет переход из пользовательской ошибки к конкретному трейс-экземпляру.</p></aside></section><section class="chapter"><h2 id="-um5csm_6" data-toc="-um5csm_6">Prometheus: метрики и алертинг</h2><p id="-um5csm_89">Prometheus &mdash; TSDB и движок запросов <span class="tooltip" id="-um5csm_93" title="Язык запросов Prometheus для анализа метрик">PromQL</span> c pull-моделью (он опрашивает /metrics у таргетов). Поддерживает <span id="-um5csm_94"><b>Counter</b></span>, <span id="-um5csm_95"><b>Gauge</b></span>, <span id="-um5csm_96"><b>Histogram</b></span>, <span id="-um5csm_97"><b>Summary</b></span>. Для кастомных сервисов используйте клиентские библиотеки; для системных метрик &mdash; экспортеры (например, <code class="code" id="-um5csm_98">node_exporter</code>).</p><section class="chapter"><h3 id="-um5csm_90" data-toc="-um5csm_90">Мини-конфиг Prometheus (scrape targets)</h3><div class="code-block" data-lang="yaml">
                global:
                scrape_interval: 15s

                scrape_configs:
                    - job_name: &quot;app&quot;
                      static_configs:
                          - targets: [&quot;app:9100&quot;]

                    - job_name: &quot;otel-collector&quot;
                      static_configs:
                          - targets: [&quot;otel-collector:9464&quot;]
            </div><aside class="prompt" data-type="note" data-title="" id="-um5csm_100"><p>Экспонируйте бизнес-метрики (например, <code class="code" id="-um5csm_101">orders_created_total</code>) и используйте гистограммы для латентности с разумными бакетами.</p></aside></section><section class="chapter"><h3 id="-um5csm_91" data-toc="-um5csm_91">Примеры PromQL для траблшутинга</h3><p id="-um5csm_102">Ошибки RPS по статусам</p><div class="code-block" data-lang="promql">sum by (status_code) (rate(http_requests_total[5m]))</div><p id="-um5csm_104">P95 латентность (Histogram)</p><div class="code-block" data-lang="promql">histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))</div><p id="-um5csm_106">Доля ошибок 5xx</p><div class="code-block" data-lang="promql">sum(rate(http_requests_total{status_code=&quot;5xx&quot;}[5m])) / sum(rate(http_requests_total[5m]))</div><p id="-um5csm_108">Насыщение CPU</p><div class="code-block" data-lang="promql">avg by (instance) (rate(process_cpu_seconds_total[5m]))</div><aside class="prompt" data-type="warning" data-title="" id="-um5csm_110"><p>Высокая <span id="-um5csm_111"><b>кардинальность</b></span> (много уникальных комбинаций лейблов) резко увеличивает нагрузку и стоимость. Не помещайте в лейблы значения с высокой изменчивостью (например, <code class="code" id="-um5csm_112">user_id</code>).</p></aside></section><section class="chapter"><h3 id="-um5csm_92" data-toc="-um5csm_92">Alerting (Alertmanager) &mdash; пример</h3><div class="code-block" data-lang="yaml">
groups:
    name: errors
rules:
    alert: HighErrorRate
    expr: sum(rate(http_requests_total{status_code=&quot;5xx&quot;}[5m])) / sum(rate(http_requests_total[5m])) &gt; 0.05
    for: 10m
    labels:
        severity: critical
    annotations:
        summary: &quot;Ошибка &gt; 5% в течение 10m&quot;
        description: &quot;Проверьте последние развёртывания и внешние зависимости.&quot;

</div><aside class="prompt" data-type="tip" data-title="" id="-um5csm_114"><p>Алерты должны ссылаться на дашборды с готовыми панелями для диагностики (латентность, нагрузка, ошибки, saturation).</p></aside></section></section><section class="chapter"><h2 id="-um5csm_7" data-toc="-um5csm_7">Grafana: дашборды, корреляция и алерты</h2><p id="-um5csm_115"><span class="tooltip" id="-um5csm_118" title="Платформа визуализации, дашбордов и алертов, поддерживающая множество источников данных">Grafana</span> &mdash; платформа визуализации и оповещений. Поддерживает источники данных Prometheus, Loki (логи), Tempo/Jaeger (трейсы) и др. Хорошая практика &mdash; строить &quot;runbook-дашборды&quot;: от верхнего уровня SLI к деталям (узкие места CPU/IO, внешние API, БД).</p><ul class="list _bullet" id="-um5csm_116"><li class="list__item" id="-um5csm_119"><p><span id="-um5csm_123"><b>Вариабельность</b></span>: переменные (service, instance, namespace) для быстрой фильтрации.</p></li><li class="list__item" id="-um5csm_120"><p><span id="-um5csm_124"><b>Аннотации</b></span>: помечайте релизы и инциденты &mdash; коррелируйте скачки метрик с событиями.</p></li><li class="list__item" id="-um5csm_121"><p><span id="-um5csm_125"><b>Exemplars</b></span>: показывайте ссылки на конкретные трейсы в точках графика гистограммы.</p></li><li class="list__item" id="-um5csm_122"><p><span id="-um5csm_126"><b>Unified Alerting</b></span>: централизуйте правила и маршрутизацию уведомлений.</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="-um5csm_117"><p>Добавляйте панель с последними ошибками из логов и ссылками на трейс по <code class="code" id="-um5csm_127">trace_id</code> &mdash; это ускоряет переход от симптома к причине.</p></aside></section><section class="chapter"><h2 id="-um5csm_8" data-toc="-um5csm_8">Корреляция логов, метрик и трейсов на практике</h2><ul class="list _bullet" id="-um5csm_128"><li class="list__item" id="-um5csm_131"><p>Логи выводите в структурированном виде (JSON) и добавляйте поля <code class="code" id="-um5csm_134">trace_id</code> и <code class="code" id="-um5csm_135">span_id</code>.</p></li><li class="list__item" id="-um5csm_132"><p>Передавайте заголовки <code class="code" id="-um5csm_136">traceparent</code> во все исходящие HTTP/RPC вызовы и в ответы клиентам.</p></li><li class="list__item" id="-um5csm_133"><p>Используйте <span class="tooltip" id="-um5csm_137" title="Ссылка на конкретный трейс внутри точки метрики (обычно гистограммы) для быстрой корреляции">exemplar</span>-ы в гистограммах, чтобы из точки латентности перейти к трейсу.</p></li></ul><div class="code-block" data-lang="json">
            {
            &quot;level&quot;: &quot;error&quot;,
            &quot;msg&quot;: &quot;Payment declined&quot;,
            &quot;trace_id&quot;: &quot;2f9c8e4b8a3c4d1e&quot;,
            &quot;span_id&quot;: &quot;7b1e&quot;,
            &quot;order_id&quot;: &quot;123e4567-e89b-12d3-a456-426614174000&quot;
        }
        </div><aside class="prompt" data-type="note" data-title="" id="-um5csm_130"><p>Структурные логи упрощают парсинг и индексирование, а также снижают риск утечки через свободный текст.</p></aside></section><section class="chapter"><h2 id="-um5csm_9" data-toc="-um5csm_9">Методики траблшутинга: RED, USE, чек-листы</h2><ul class="list _bullet" id="-um5csm_138"><li class="list__item" id="-um5csm_140"><p><span id="-um5csm_143"><b>RED</b></span> (Rate, Errors, Duration) &mdash; для пользовательских сервисов: следите за RPS, ошибками и длительностью.</p></li><li class="list__item" id="-um5csm_141"><p><span id="-um5csm_144"><b>USE</b></span> (Utilization, Saturation, Errors) &mdash; для ресурсов: CPU, память, диск, сеть.</p></li><li class="list__item" id="-um5csm_142"><p><span id="-um5csm_145"><b>Чек-лист инцидента</b></span>: верифицируйте алерт, оцените blast radius, зафиксируйте таймлайн, включите фича-флаги/откаты, соберите трейсы/метрики/логи, оформите postmortem с действиями.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="-um5csm_139"><p>Без фиксированных SLO расследование превращается в &quot;ощущения&quot;. Формализуйте целевые показатели заранее.</p></aside></section><section class="chapter"><h2 id="-um5csm_10" data-toc="-um5csm_10">Производительность и стоимость: семплинг, бакеты, ретеншн</h2><ul class="list _bullet" id="-um5csm_146"><li class="list__item" id="-um5csm_148"><p><span id="-um5csm_151"><b>Семплинг трейсов</b></span>: снижает объём, оставляет репрезентативную картину. Tail-based в Collector выбирает интересные трейсы (ошибки, высокую латентность).</p></li><li class="list__item" id="-um5csm_149"><p><span id="-um5csm_152"><b>Гистограммы</b></span>: заранее продумайте бакеты (например, 10, 25, 50, 100, 250, 500, 1000&nbsp;мс). Слишком мелкие бакеты =&gt; рост кардинальности.</p></li><li class="list__item" id="-um5csm_150"><p><span id="-um5csm_153"><b>Ретеншн</b></span>: разные сроки хранения для &quot;сырых&quot; и агрегированных данных. Используйте recording rules.</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="-um5csm_147"><p>Включайте <span id="-um5csm_154"><b>релабелинг</b></span> и <span id="-um5csm_155"><b>дропаут</b></span> метрик в Prometheus для шумных меток.</p></aside></section><section class="chapter"><h2 id="-um5csm_11" data-toc="-um5csm_11">Безопасность и соответствие требованиям</h2><ul class="list _bullet" id="-um5csm_156"><li class="list__item" id="-um5csm_158"><p>Санитизируйте атрибуты спанов и поля логов (удаляйте токены, номера карт, персональные данные).</p></li><li class="list__item" id="-um5csm_159"><p>Ограничьте доступ к UI и API наблюдаемости (SSO, RBAC, сетевые политики).</p></li><li class="list__item" id="-um5csm_160"><p>Шифруйте трафик OTLP и хранение, если требуется по политике.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="-um5csm_157"><p>Случайная передача PII в трейсах может привести к утечке. Настройте фильтры в Collector и аудиты схем логов.</p></aside></section><section class="chapter"><h2 id="-um5csm_12" data-toc="-um5csm_12">Типовые ошибки и их исправление</h2><ul class="list _bullet" id="-um5csm_161"><li class="list__item" id="-um5csm_163"><p><span id="-um5csm_167"><b>Трейсы рвутся</b></span>: не передаётся <code class="code" id="-um5csm_168">traceparent</code>. Проверьте прокси/балансировщики, включите автоинструментирование HTTP-клиентов/серверов.</p></li><li class="list__item" id="-um5csm_164"><p><span id="-um5csm_169"><b>Пустые дашборды</b></span>: Prometheus не видит таргеты. Проверьте <code class="code" id="-um5csm_170">scrape_configs</code>, сетевые политики, TLS.</p></li><li class="list__item" id="-um5csm_165"><p><span id="-um5csm_171"><b>Большие счета за хранение</b></span>: высокая кардинальность метрик/атрибутов. Пересмотрите лейблы, бакеты, ретеншн и семплинг.</p></li><li class="list__item" id="-um5csm_166"><p><span id="-um5csm_172"><b>Шумные алерты</b></span>: нет гистерезиса/задержки <code class="code" id="-um5csm_173">for:</code>, пороги не привязаны к SLO. Настройте дедупликацию и маршрутизацию алертов.</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="-um5csm_162"><p>Заведите <span id="-um5csm_174"><b>runbook</b></span> на каждый критичный алерт: предпосылки, шаги диагностики, команды, точки отката, владельцы.</p></aside></section><section class="chapter"><h2 id="-um5csm_13" data-toc="-um5csm_13">FAQ и лучшие практики</h2><ul class="list _bullet" id="-um5csm_175"><li class="list__item" id="-um5csm_178"><p>С чего начать? &mdash; Инструментируйте один критичный путь (например, &quot;создание заказа&quot;), подключите OTel и Jaeger, затем добавляйте метрики и алерты.</p></li><li class="list__item" id="-um5csm_179"><p>Как измерять пользовательские SLI? &mdash; Введите явные бизнес-метрики (время ответа ключевых операций, доля успешных платежей).</p></li><li class="list__item" id="-um5csm_180"><p>Как связать логи и трейсы? &mdash; Добавляйте <code class="code" id="-um5csm_181">trace_id</code> в контекст логгера; используйте middleware для авто-обогащения.</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="-um5csm_176"><p>Правильное именование: сервисы, операции (span name), метки метрик &mdash; согласуйте словарь и следуйте семантическим соглашениям OTel.</p></aside><aside class="prompt" data-type="note" data-title="" id="-um5csm_177"><p>Правильное написание &mdash; <span id="-um5csm_182"><b>Prometheus</b></span>. Встречающийся вариант &quot;Prometeus&quot; &mdash; ошибка.</p></aside></section><div class="last-modified">26 сентября 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="api.html" class="navigation-links__prev">API-контракты</a><a href="локальная-разработка-составных-сервисов.html" class="navigation-links__next">Локальная разработка составных сервисов</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>