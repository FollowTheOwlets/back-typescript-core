<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#C14424" data-link-color="#C14424"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-01T18:55:34.9239476"><title>Микросервисная архитектура | Backend Typescript</title><script type="application/json" id="virtual-toc-data">[{"id":"-knymu1_4","level":0,"title":"Зачем это нужно: цели и идеи","anchor":"#-knymu1_4"},{"id":"-knymu1_5","level":0,"title":"Ключевые принципы реализации","anchor":"#-knymu1_5"},{"id":"-knymu1_6","level":0,"title":"Как выбирать границы сервисов","anchor":"#-knymu1_6"},{"id":"-knymu1_7","level":0,"title":"Коммуникации между сервисами","anchor":"#-knymu1_7"},{"id":"-knymu1_8","level":0,"title":"Данные и согласованность","anchor":"#-knymu1_8"},{"id":"-knymu1_9","level":0,"title":"Деплой и инфраструктура","anchor":"#-knymu1_9"},{"id":"-knymu1_10","level":0,"title":"Наблюдаемость и эксплуатация","anchor":"#-knymu1_10"},{"id":"-knymu1_11","level":0,"title":"Тестирование и качество","anchor":"#-knymu1_11"},{"id":"-knymu1_12","level":0,"title":"Безопасность","anchor":"#-knymu1_12"},{"id":"-knymu1_13","level":0,"title":"Когда стоит и когда нет","anchor":"#-knymu1_13"},{"id":"-knymu1_14","level":0,"title":"Чек-лист внедрения","anchor":"#-knymu1_14"},{"id":"-knymu1_15","level":0,"title":"Мини-пример: идемпотентный запрос","anchor":"#-knymu1_15"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="images/logo.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Микросервисная архитектура | Backend Typescript"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Backend Typescript Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation//1.0.0/microarch.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Микросервисная архитектура | Backend Typescript"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation//1.0.0/microarch.html#webpage",
    "url": "writerside-documentation//1.0.0/microarch.html",
    "name": "Микросервисная архитектура | Backend Typescript",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Backend Typescript Help"
}</script><!-- End Schema.org --></head><body data-id="MicroArch" data-main-title="Микросервисная архитектура" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="_Theory.topic|Теория///_Arch.topic|Архитектура"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Backend Typescript 1.0.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="MicroArch" id="MicroArch.topic">Микросервисная архитектура</h1><p id="-knymu1_2"><span id="-knymu1_16"><b>Определение.</b></span> <span class="tooltip" id="-knymu1_17" title="Автономный процесс, реализующий узкую бизнес-возможность, владеющий собственными данными и имеющий явные контракты взаимодействия">Микросервис</span> &mdash; это автономный процесс, реализующий узкую <span class="tooltip" id="-knymu1_18" title="Чётко определённая область ответственности и данных, внутри которой сервис гарантирует инварианты">бизнес-возможность</span>, владеющий своими данными и взаимодействующий с другими сервисами по <span class="tooltip" id="-knymu1_19" title="Формальное описание интерфейса взаимодействия (методы, схемы, коды ответов), служащее основанием для интеграции">явным контрактам</span>. Цель &mdash; добиться <span class="tooltip" id="-knymu1_20" title="Минимальная зависимость между сервисами, позволяющая менять их независимо">слабой связности</span> между компонентами при высокой <span class="tooltip" id="-knymu1_21" title="Сильная внутренняя связность кода и данных внутри одного сервиса вокруг одной задачи">внутренней связности</span> каждого сервиса, чтобы команды могли независимо разрабатывать, тестировать, развёртывать и масштабировать части системы.</p><aside class="prompt" data-type="note" data-title="" id="-knymu1_3"><p>Микросервисы &mdash; не про &laquo;много маленьких файлов&raquo;, а про организацию системы и команд вокруг <span class="tooltip" id="-knymu1_22" title="Чётко определённая область ответственности и данных, внутри которой сервис гарантирует инварианты">чётких границ ответственности</span>, контрактов и операционной автономии.</p></aside><section class="chapter"><h2 id="-knymu1_4" data-toc="-knymu1_4">Зачем это нужно: цели и идеи</h2><ul class="list _bullet" id="-knymu1_23"><li class="list__item" id="-knymu1_25"><p><span id="-knymu1_30"><b>Независимые поставки.</b></span> Каждая команда выпускает изменения в своём сервисе без координации &laquo;больших релизов&raquo;.</p></li><li class="list__item" id="-knymu1_26"><p><span id="-knymu1_31"><b>Изоляция рисков.</b></span> Сбой одного сервиса не &laquo;роняет&raquo; всю систему при корректной деградации и таймаутах.</p></li><li class="list__item" id="-knymu1_27"><p><span id="-knymu1_32"><b>Выбор технологий.</b></span> Разные сервисы могут использовать разные стеки, если это оправдано и не ломает операционную совместимость.</p></li><li class="list__item" id="-knymu1_28"><p><span id="-knymu1_33"><b>Масштабирование по компонентам.</b></span> Нагруженные сервисы масштабируются независимо, экономя ресурсы.</p></li><li class="list__item" id="-knymu1_29"><p><span id="-knymu1_34"><b>Орг-соответствие.</b></span> Архитектура отражает структуру команд (закон Конвея), уменьшая коммуникационные накладные расходы.</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="-knymu1_24"><p>Правило мысленного &laquo;лифтового питча&raquo;: сформулируйте назначение сервиса одной фразой. Если не получается &mdash; границы сервиса размыты.</p></aside></section><section class="chapter"><h2 id="-knymu1_5" data-toc="-knymu1_5">Ключевые принципы реализации</h2><ul class="list _bullet" id="-knymu1_35"><li class="list__item" id="-knymu1_36"><p><span id="-knymu1_44"><b>Автономия данных.</b></span> Каждый сервис владеет собственной схемой и не делит таблицы с соседями.</p></li><li class="list__item" id="-knymu1_37"><p><span id="-knymu1_45"><b>Явные контракты.</b></span> Общение только через <span class="tooltip" id="-knymu1_46" title="Формальное описание интерфейса взаимодействия (методы, схемы, коды ответов), служащее основанием для интеграции">API</span> с <span class="tooltip" id="-knymu1_47" title="Свойство нового контракта не ломать существующих потребителей">обратной совместимостью</span> и <span class="tooltip" id="-knymu1_48" title="Практика одновременной поддержки нескольких версий контракта (например, /v1 и /v2)">версионированием</span>.</p></li><li class="list__item" id="-knymu1_38"><p><span id="-knymu1_49"><b>Синхронное vs асинхронное.</b></span> Синхронные вызовы (HTTP/gRPC) &mdash; для &laquo;онлайн&raquo; путей; асинхронные очереди/шины &mdash; для интеграций и фоновых реакций.</p></li><li class="list__item" id="-knymu1_39"><p><span id="-knymu1_50"><b>Идемпотентность.</b></span> Повторная обработка сообщений и запросов не должна менять результат непредсказуемо.</p></li><li class="list__item" id="-knymu1_40"><p><span id="-knymu1_51"><b>Наблюдаемость по умолчанию.</b></span> Логи, метрики и <span class="tooltip" id="-knymu1_52" title="Сбор и связывание спанов по всему пути запроса через несколько сервисов">трассировки</span> &mdash; часть функциональных требований.</p></li><li class="list__item" id="-knymu1_41"><p><span id="-knymu1_53"><b>Операционная готовность.</b></span> Здоровье, readiness/liveness-пробы, сводные <span class="tooltip" id="-knymu1_54" title="Целевая метрика надёжности/производительности (например, 99.5% запросов быстрее 300 мс)">SLO</span> и алерты &mdash; сразу в первый релиз.</p></li><li class="list__item" id="-knymu1_42"><p><span id="-knymu1_55"><b>Автоматизация.</b></span> CI/CD, неизменяемые образы, декларативная инфраструктура и миграции данных.</p></li><li class="list__item" id="-knymu1_43"><p><span id="-knymu1_56"><b>Безопасность по умолчанию.</b></span> <span class="tooltip" id="-knymu1_57" title="Модель безопасности «не доверяй по умолчанию», требующая проверки и шифрования даже внутри периметра">Недоверие по умолчанию</span>, <span class="tooltip" id="-knymu1_58" title="Взаимная TLS-аутентификация между сервисами на транспортном уровне">mTLS</span>, наименьшие привилегии, безопасное хранение секретов.</p></li></ul></section><section class="chapter"><h2 id="-knymu1_6" data-toc="-knymu1_6">Как выбирать границы сервисов</h2><p id="-knymu1_59">Режьте систему по предметным возможностям и потокам данных, а не по техническим слоям (не &laquo;контроллеры&raquo;, &laquo;репозитории&raquo;, а &laquo;Платёж&raquo;, &laquo;Каталог&raquo;, &laquo;Доставка&raquo;). Учитывайте частоту изменений: то, что меняется вместе, должно жить вместе.</p><ul class="list _bullet" id="-knymu1_60"><li class="list__item" id="-knymu1_63"><p>У каждого сервиса &mdash; собственная база, договорённости на уровне событий/контрактов.</p></li><li class="list__item" id="-knymu1_64"><p>Минимизируйте &laquo;сквозные&raquo; транзакции &mdash; вместо этого проектируйте локальные инварианты и чёткие реакции на факты.</p></li><li class="list__item" id="-knymu1_65"><p>Проверка границ: может ли сервис быть временно недоступен без обрушения пользовательского сценария? Если нет &mdash; границы выбраны плохо.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="-knymu1_61"><p>Общая база данных для нескольких сервисов приводит к скрытым связям, совместным миграциям и потерям автономии.</p></aside><aside class="prompt" data-type="warning" data-title="" id="-knymu1_62"><p>&laquo;Тонкий сервис&raquo; над общим монолитом создаёт иллюзию микросервисов, но сохраняет старые проблемы.</p></aside></section><section class="chapter"><h2 id="-knymu1_7" data-toc="-knymu1_7">Коммуникации между сервисами</h2><p id="-knymu1_66">Синхронные вызовы упрощают запрос-ответ, но удлиняют критический путь: каждая новая &laquo;стыковка&raquo; увеличивает P95/таймауты. Асинхронные взаимодействия повышают устойчивость и разгружают фронт, но требуют проектирования доставки, повторов и порядка.</p><ul class="list _bullet" id="-knymu1_67"><li class="list__item" id="-knymu1_70"><p><span id="-knymu1_73"><b>Контракты и версии.</b></span> Не ломайте существующих потребителей: вводите <code class="code" id="-knymu1_74">/v2</code> как отдельный контракт.</p></li><li class="list__item" id="-knymu1_71"><p><span id="-knymu1_75"><b>Таймауты и повторы.</b></span> Любая сеть ненадёжна: задавайте конечные таймауты, ограниченные ретраи и <span class="tooltip" id="-knymu1_76" title="Свойство операции давать тот же эффект при повторном выполнении.">идемпотентные</span> операции.</p></li><li class="list__item" id="-knymu1_72"><p><span id="-knymu1_77"><b>Корреляция.</b></span> Передавайте <span class="tooltip" id="-knymu1_78" title="Уникальный идентификатор, передаваемый сквозь все вызовы для связывания логов и трассировок">Correlation-ID</span> сквозь все вызовы.</p></li></ul><div class="code-block" data-lang="yaml">
          openapi: 3.0.3
          info:
              title: Orders API
              version: &quot;1.0&quot;
              paths:
                /v1/orders:
                  post:
                    summary: Create order
                    parameters:
                      - in: header
                        name: Idempotency-Key
                        schema:
                        type: string
                        responses:
                          &quot;201&quot;:
                            description: created
                          &quot;409&quot;:
                            description: duplicate
        </div><aside class="prompt" data-type="note" data-title="" id="-knymu1_69"><p>Контракт явно фиксирует заголовок <code class="code" id="-knymu1_79">Idempotency-Key</code> для безопасных повторов.</p></aside></section><section class="chapter"><h2 id="-knymu1_8" data-toc="-knymu1_8">Данные и согласованность</h2><p id="-knymu1_80">Глобальных транзакций в распределённых системах лучше избегать: они хрупки и медленны. Проектируйте локальные транзакции в пределах сервиса и механизмы уведомления соседей о &laquo;свершившихся фактах&raquo;. Принимайте <span class="tooltip" id="-knymu1_84" title="Модель, при которой данные между сервисами приходят к一致ию через некоторое время">согласованность в итоге</span> там, где это допустимо бизнесом.</p><ul class="list _bullet" id="-knymu1_81"><li class="list__item" id="-knymu1_85"><p>Каждое изменение фиксируется локально, а затем доносится до других сервисов сообщением/вебхуком.</p></li><li class="list__item" id="-knymu1_86"><p>Получатели обязаны уметь безопасно обрабатывать повторы и внепорядковость.</p></li><li class="list__item" id="-knymu1_87"><p>Критичные инварианты (например, &laquo;баланс не уходит в минус&raquo;) должны сохраняться локально, без внешних вызовов.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="-knymu1_82"><p>Двухфазные коммиты и распределённые транзакции часто ломаются под нагрузкой и увеличивают задержки.</p></aside><aside class="prompt" data-type="tip" data-title="" id="-knymu1_83"><p>Используйте детерминированные ключи (например, <code class="code" id="-knymu1_88">orderId</code>) и idempotent-вставки/обновления.</p></aside></section><section class="chapter"><h2 id="-knymu1_9" data-toc="-knymu1_9">Деплой и инфраструктура</h2><p id="-knymu1_89">Стандартная операционная база: сервисы согласно доменной модели, по базе для каждого сервиса и многие другие участники микросервисной инфраструктуры. Поставляйте неизменяемые образы и конфигурации как код.</p><div class="code-block" data-lang="yaml">
# Минимальный пример изоляции: у каждого сервиса своя БД
services:
    users:
        image: example/users:1.0.0
        environment:
            - DB_URL=postgres://users-db/...

    users-db:
        image: postgres:16

    orders:
        image: example/orders:1.0.0
        environment:
            - DB_URL=postgres://orders-db/...

    orders-db:
        image: postgres:16
        </div><aside class="prompt" data-type="warning" data-title="" id="-knymu1_91"><p>Чрезмерная &laquo;дробность&raquo; (десятки микросервисов без реальной необходимости) увеличивает операционные затраты и сложность отладки.</p></aside><aside class="prompt" data-type="note" data-title="" id="-knymu1_92"><p>Практичный путь миграции &mdash; начать с <span class="tooltip" id="-knymu1_93" title="Монолит, организованный как набор изолированных модулей с публичными контрактами и скрытыми внутренностями">модульного монолита</span>, затем выделять действительно зрелые границы в отдельные сервисы.</p></aside></section><section class="chapter"><h2 id="-knymu1_10" data-toc="-knymu1_10">Наблюдаемость и эксплуатация</h2><p id="-knymu1_94">Производственная готовность включает три столпа: <span class="tooltip" id="-knymu1_96" title="Запись структурированных событий выполнения системы для расследования инцидентов и аудита">логи</span>, <span class="tooltip" id="-knymu1_97" title="Агрегированные числовые показатели работы системы (латентность, ошибки, нагрузка), используемые для алертинга">метрики</span>, <span class="tooltip" id="-knymu1_98" title="Сбор и связывание спанов по всему пути запроса через несколько сервисов">трассировки</span>. Определите целевые <span class="tooltip" id="-knymu1_99" title="Целевая метрика надёжности/производительности (например, 99.5% запросов быстрее 300 мс)">SLO</span>, на их основе стройте алерты и бюджет ошибок.</p><ul class="list _bullet" id="-knymu1_95"><li class="list__item" id="-knymu1_100"><p>Логи: структурированные, с полями запроса/пользователя/корреляции.</p></li><li class="list__item" id="-knymu1_101"><p>Метрики: латентность, частота ошибок, насыщение ресурсов.</p></li><li class="list__item" id="-knymu1_102"><p>Трассировки: единый Correlation-ID на весь путь запроса.</p></li></ul></section><section class="chapter"><h2 id="-knymu1_11" data-toc="-knymu1_11">Тестирование и качество</h2><ul class="list _bullet" id="-knymu1_103"><li class="list__item" id="-knymu1_105"><p><span id="-knymu1_109"><b>Юнит-тесты</b></span> для предметной логики внутри сервиса.</p></li><li class="list__item" id="-knymu1_106"><p><span id="-knymu1_110"><b>Контрактные тесты</b></span> потребителя и поставщика API, чтобы ловить несовместимые изменения.</p></li><li class="list__item" id="-knymu1_107"><p><span id="-knymu1_111"><b>Интеграционные тесты</b></span> с локальными зависимостями (контейнеры/фейки), чтобы сценарии были воспроизводимыми.</p></li><li class="list__item" id="-knymu1_108"><p><span id="-knymu1_112"><b>E2E</b></span> &mdash; немного и по критическим путям, иначе они станут хрупкими и медленными.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="-knymu1_104"><p>Опора на внешние &laquo;живые&raquo; окружения в тестах ведёт к нестабильности и ложным падениям.</p></aside></section><section class="chapter"><h2 id="-knymu1_12" data-toc="-knymu1_12">Безопасность</h2><ul class="list _bullet" id="-knymu1_113"><li class="list__item" id="-knymu1_114"><p><span id="-knymu1_118"><b>Аутентификация и авторизация</b></span> на границе (шлюз) и внутри (межсервисные токены).</p></li><li class="list__item" id="-knymu1_115"><p><span id="-knymu1_119"><b>Шифрование</b></span> на транспорте (<span class="tooltip" id="-knymu1_120" title="Взаимная TLS-аутентификация между сервисами на транспортном уровне">mTLS</span>) и в покое.</p></li><li class="list__item" id="-knymu1_116"><p><span id="-knymu1_121"><b>Секреты</b></span> только в менеджере секретов, с ротацией.</p></li><li class="list__item" id="-knymu1_117"><p><span id="-knymu1_122"><b>Аудит</b></span> действий и доступов.</p></li></ul></section><section class="chapter"><h2 id="-knymu1_13" data-toc="-knymu1_13">Когда стоит и когда нет</h2><ul class="list _bullet" id="-knymu1_123"><li class="list__item" id="-knymu1_125"><p><span id="-knymu1_127"><b>Подходит,</b></span> если много команд, быстрые релизы, высокие требования к масштабированию и изоляции отказов.</p></li><li class="list__item" id="-knymu1_126"><p><span id="-knymu1_128"><b>Не подходит,</b></span> если домен простой, команда мала, а основные проблемы &mdash; в качестве кода и процессах, а не в архитектуре.</p></li></ul><aside class="prompt" data-type="warning" data-title="" id="-knymu1_124"><p>Переезд на микросервисы &laquo;ради моды&raquo; приведёт к росту сложности без выгоды.</p></aside></section><section class="chapter"><h2 id="-knymu1_14" data-toc="-knymu1_14">Чек-лист внедрения</h2><ul class="list _bullet" id="-knymu1_129"><li class="list__item" id="-knymu1_130"><p>Цели и ожидаемые метрики (скорость релизов, P95, надёжность).</p></li><li class="list__item" id="-knymu1_131"><p>Карта домена и кандидаты на сервисные границы.</p></li><li class="list__item" id="-knymu1_132"><p>Стандарты контрактов и версионирования.</p></li><li class="list__item" id="-knymu1_133"><p>Стратегии коммуникаций (где синхронно, где асинхронно).</p></li><li class="list__item" id="-knymu1_134"><p>Владение данными и правила согласованности.</p></li><li class="list__item" id="-knymu1_135"><p>Базовая наблюдаемость и пороговые SLO.</p></li><li class="list__item" id="-knymu1_136"><p>CI/CD, окружения, миграции, откаты.</p></li><li class="list__item" id="-knymu1_137"><p>Модель безопасности и работа с секретами.</p></li><li class="list__item" id="-knymu1_138"><p>Runbook и он-колл: кто, как и чем реагирует.</p></li></ul></section><section class="chapter"><h2 id="-knymu1_15" data-toc="-knymu1_15">Мини-пример: идемпотентный запрос</h2><p id="-knymu1_139">Создание заказа должно безопасно переживать повторную отправку клиента/ретраи сети. Контракт вводит заголовок <code class="code" id="-knymu1_142">Idempotency-Key</code>, по которому сервер распознаёт дубликаты.</p><div class="code-block" data-lang="http">
POST /v1/orders HTTP/1.1
Host: api.example.com
Idempotency-Key: 3f5c1f90-5a9b-4a6f-9a10-1f0e0b1c7a22
Content-Type: application/json

{
&quot;items&quot;: [{&quot;sku&quot;: &quot;SKU123&quot;, &quot;qty&quot;: 2}],
&quot;customerId&quot;: &quot;cst_001&quot;
}
</div><aside class="prompt" data-type="note" data-title="" id="-knymu1_141"><p>При втором таком же запросе сервер возвращает тот же результат (например, <code class="code" id="-knymu1_143">201</code> с тем же <code class="code" id="-knymu1_144">orderId</code> или <code class="code" id="-knymu1_145">409</code> &laquo;duplicate&raquo; по договорённости).</p></aside></section><div class="last-modified">01 октября 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="monoarch.html" class="navigation-links__prev">Монолитная архитектура</a><a href="micropatterns.html" class="navigation-links__next">Паттерны микросервисной архитектуры</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>